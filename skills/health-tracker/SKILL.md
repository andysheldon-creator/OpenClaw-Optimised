---
name: health-tracker
description: 追踪和管理劭杰的健康数据（饮食、睡眠、用药）。用于记录每日饮食、睡眠时间、用药情况，发送提醒，以及查询健康历史。当用户提到吃饭、睡觉、吃药、健康记录、饮食起居时使用此 skill。
---

# Health Tracker 健康管理

追踪爸爸的饮食、睡眠和用药，保持健康好习惯！

## Discord 配置

- **服务器**：我们的小家 🏠 (`1467528690970656801`)
- **频道**：健康管理 (`1467742051574485003`)
- **爸爸 ID**：`561391916789399583`（发提醒时要 @）
- **用途**：发送健康提醒和记录

## 数据存储

健康数据存储在 workspace 的 `health/` 目录：

```
health/
├── daily/           # 每日记录 (YYYY-MM-DD.md)
├── summary.md       # 汇总统计
└── config.md        # 个人配置（作息时间、用药信息等）
```

## 记录格式

### 每日记录 (`health/daily/YYYY-MM-DD.md`)

```markdown
# YYYY-MM-DD 健康记录

## 🍚 饮食

- **早餐** (HH:MM): 内容
- **午餐** (HH:MM): 内容
- **晚餐** (HH:MM): 内容
- **加餐**: 内容

## 💊 用药

- **吃药时间**: HH:MM
- **状态**: 正常 / ⚠️ 太晚

## 💤 睡眠

- **入睡**: HH:MM
- **起床**: HH:MM
- **时长**: X 小时 X 分钟
- **质量**: 好/一般/差

## 📝 备注

（任何其他健康相关记录）
```

## 用药管理 💊

### 日常用药（参考 config.md）

| 药名                 | 剂量     | 用途            |
| -------------------- | -------- | --------------- |
| 美时玉（盐酸曲唑酮） | 10mg/天  | 助眠/情绪调节   |
| 草酸艾司西酞普兰     | 10mg/天  | 抗焦虑/情绪调节 |
| 佐匹克隆             | 7.5mg/天 | 助眠            |

### 吃药提醒流程

1. **每日 22:30** 发送吃药提醒
2. 爸爸确认吃药后，记录时间到当日文件
3. **吃药后 25 分钟** 发送放下手机提醒
4. 如果超过 23:30 还没吃药，再次提醒

### 放下手机提醒 📱

吃完安眠药后必须提醒放下手机！

**重要**：佐匹克隆药效约 20-30 分钟起效，如果继续玩手机会熬过药效。

**实现方式**：使用 isolated session 确保提醒一定发出（不依赖 main session 状态）

```javascript
// 1. 用 exec 计算时间戳
exec: echo $(( $(date +%s) + 25*60 ))000

// 2. 检查是否已有待触发的提醒（防止重复）
cron action=list
// 查找 name 包含 "放下手机提醒" 的 job
// 如果有 → cron action=remove jobId=<id>

// 3. 创建 cron job
cron action=add job={
  "name": "放下手机提醒",
  "schedule": { "kind": "at", "atMs": <计算出的时间戳> },
  "sessionTarget": "isolated",
  "payload": {
    "kind": "agentTurn",
    "message": "发送放下手机提醒到 Discord 健康管理频道 (1467742051574485003)，@ 爸爸 (<@561391916789399583>)。提醒他药效要起作用了，该放下手机睡觉了。语气要温柔但坚定。",
    "deliver": true,
    "channel": "discord",
    "to": "1467742051574485003"
  }
}
```

**防止重复提醒**：

- 用固定的 job name："放下手机提醒"
- 每次设置前先 `cron action=list` 检查
- 有同名 pending job → 先删除再创建
- 这样不管爸爸说几次"吃药了"，都只有一个提醒

**为什么用 isolated session**：

- main session 可能在其他频道/会话聊天
- isolated session 独立运行，不受 main session 状态影响
- deliver 参数确保结果直接发到指定频道

## 提醒时间

| 提醒     | 时间           | 内容                       |
| -------- | -------------- | -------------------------- |
| 午餐     | 12:00          | 该吃午饭了                 |
| 晚餐     | 19:00          | 晚餐时间到                 |
| 吃药     | 22:30          | 该吃药准备睡觉了           |
| 放下手机 | 吃药后 25 分钟 | 药效要起作用了，放下手机！ |

## 时间戳计算 ⚠️

设置 cron 一次性提醒时，**必须正确计算时间戳**！

### 方法：用 exec 计算

```bash
# 获取当前时间戳（毫秒）
date +%s000

# 计算 N 分钟后的时间戳
echo $(( $(date +%s) + 25*60 ))000
```

### 常见错误

- ❌ 手动输入时间戳容易搞错年份
- ❌ 忘记乘以 1000（毫秒 vs 秒）
- ✅ 用 `date` 命令计算最安全

## 使用方式

### 记录饮食

当爸爸说吃了什么，记录到当日文件并发送到 Discord 频道确认。

### 记录睡眠

当爸爸说睡觉/起床，记录时间并计算睡眠时长。

### 记录吃药

当爸爸说吃药了，记录时间并设置放下手机提醒。

### 发送提醒

通过 Discord 健康管理频道发送提醒（记得 @ 爸爸）：

```
message action=send channel=discord target=1467742051574485003 message="<@561391916789399583> 提醒内容"
```

### 查询历史

读取 `health/daily/` 目录下的历史记录进行汇总。

## 注意事项

- 记录时使用友好的语气，不要像机器人
- 提醒要温和但坚定，尤其是放下手机提醒
- 尊重爸爸的隐私，健康数据只在指定频道讨论
- 吃药时间太晚（超过 23:30）要在备注里标记 ⚠️
- 设置定时提醒时，用 exec 计算时间戳，不要手动输入！
